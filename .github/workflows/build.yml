name: build
on: [push, pull_request, merge_group]
jobs:
  build-lib:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: [thumbv6m-none-eabi, thumbv7m-none-eabi, thumbv7em-none-eabi, thumbv7em-none-eabihf, thumbv8m.base-none-eabi, thumbv8m.main-none-eabi, thumbv8m.main-none-eabihf]
    steps:
      - uses: actions/checkout@v4
      - run: |
          rustup target add ${{ matrix.target }}
      - run: |
          cargo build --all-features --target=${{ matrix.target }}
  build-examples:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: [thumbv6m-none-eabi, thumbv7m-none-eabi, thumbv7em-none-eabi, thumbv7em-none-eabihf, thumbv8m.base-none-eabi, thumbv8m.main-none-eabi, thumbv8m.main-none-eabihf]
    steps:
      - uses: actions/checkout@v4
      - run: |
          rustup target add ${{ matrix.target }}
      - run: |
          cd examples
          cargo build --target=${{ matrix.target }} --release
  build-all:
    runs-on: ubuntu-latest
    needs: [build-lib, build-examples]
    steps:
      - run: /bin/true
