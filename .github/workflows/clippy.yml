name: clippy
on: [push, pull_request, merge_group]
jobs:
  clippy-lib:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: [thumbv6m-none-eabi, thumbv7m-none-eabi, thumbv7em-none-eabi, thumbv7em-none-eabihf, thumbv8m.base-none-eabi, thumbv8m.main-none-eabi, thumbv8m.main-none-eabihf]
    steps:
      - uses: actions/checkout@v4
      - run: |
          rustup target add ${{ matrix.target }}
      - run: |
          cargo clippy --target=${{ matrix.target }}
  clippy-examples:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: [thumbv6m-none-eabi, thumbv7m-none-eabi, thumbv7em-none-eabi, thumbv7em-none-eabihf, thumbv8m.base-none-eabi, thumbv8m.main-none-eabi, thumbv8m.main-none-eabihf]
    steps:
      - uses: actions/checkout@v4
      - run: |
          rustup target add ${{ matrix.target }}
      - run: |
          cd examples
          cargo clippy --target=${{ matrix.target }}
  clippy-all:
    runs-on: ubuntu-latest
    needs: [clippy-lib, clippy-examples]
    steps:
      - run: /bin/true
